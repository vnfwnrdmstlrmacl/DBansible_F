---
# roles/backup/tasks/pgbackrest_stanza.yml
# follow-primary 기반으로 stanza-create/check 수행

# main.yml에서 backup_clients에만 import_tasks 하므로 여기서는 assert로 실패시키지 않는다.

- name: Stanza create (follow primary)
  ansible.builtin.command:
    argv: ["/usr/local/bin/pgbackrest_follow_primary", "stanza-create"]
  register: stanza_create
  changed_when: false

- name: Check (follow primary)
  ansible.builtin.command:
    argv: ["/usr/local/bin/pgbackrest_follow_primary", "check"]
  register: pgbr_check
  changed_when: false

- name: Print stanza-create output
  ansible.builtin.debug:
    var: stanza_create.stdout_lines

- name: Print check output
  ansible.builtin.debug:
    var: pgbr_check.stdout_lines
