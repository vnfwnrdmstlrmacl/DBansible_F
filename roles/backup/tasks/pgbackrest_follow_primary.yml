---
# roles/backup/tasks/pgbackrest_follow_primary.yml

# main.yml에서 backup_clients에만 import_tasks 하므로 여기서는 assert로 실패시키지 않는다.

- name: Validate Patroni leader detection (dry-run)
  ansible.builtin.command:
    argv: ["/usr/local/bin/pgbackrest_follow_primary", "whoisprimary"]
  register: leader
  changed_when: false

- name: Print detected leader
  ansible.builtin.debug:
    var: leader.stdout
