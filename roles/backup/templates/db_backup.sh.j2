#!/bin/bash
set -euo pipefail

STANZA="{{ pgbackrest_stanza | default('main') }}"
LOG_FILE="/var/log/db_backup.log"

echo "===== [$(date '+%F %T')] pgBackRest backup start (stanza=${STANZA}) =====" >> "${LOG_FILE}"

# (선택) repo/info 확인
pgbackrest --stanza="${STANZA}" info >> "${LOG_FILE}" 2>&1 || true

# Full backup (필요시 --type=full 명시)
pgbackrest --stanza="${STANZA}" backup >> "${LOG_FILE}" 2>&1

echo "===== [$(date '+%F %T')] pgBackRest backup done (stanza=${STANZA}) =====" >> "${LOG_FILE}"

